<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í™˜ì í˜ì´ì§€ - ì¼€ì–´ë…¸íŠ¸ (OB/GYN)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: "Inter", sans-serif; background-color: #fff1f2; }
        .page-section { display: none; }
        .page-section.active { display: block; }
        .hidden-section { display: none; }
        
        /* ì»¤ìŠ¤í…€ UI ìŠ¤íƒ€ì¼ */
        .category-btn.selected { background-color: #be185d; color: white; border-color: #be185d; }
        
        .sidebar-patient-link {
            display: block; padding: 0.85rem 1rem; border-radius: 0.5rem;
            color: #d1d5db; font-weight: 500; font-size: 1.125rem; cursor: pointer;
            margin-bottom: 0.5rem; transition: all 0.2s; border: 2px solid transparent;
        }
        .sidebar-patient-link:hover { background-color: #374151; color: #ffffff; }
        .sidebar-patient-link.selected { background-color: #be185d; color: #ffffff; font-weight: 600; }
        
        .question-card {
            background-color: #ffffff; border: 1px solid #e5e7eb; border-radius: 0.75rem;
            padding: 1.5rem; margin-bottom: 1rem; box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }
        .question-title { font-size: 1.1rem; font-weight: 700; margin-bottom: 0.75rem; color: #1f2937; }
        .sub-label { font-size: 0.9rem; color: #6b7280; margin-bottom: 0.5rem; display: block; }
        
        .checkbox-group label, .radio-group label {
            display: flex; align-items: center; padding: 0.75rem;
            border: 1px solid #e5e7eb; border-radius: 0.5rem; margin-bottom: 0.5rem;
            cursor: pointer; transition: all 0.2s; font-size: 0.95rem;
        }
        .checkbox-group label:hover, .radio-group label:hover { background-color: #fff0f5; border-color: #fbcfe8; }
        .checkbox-group input, .radio-group input { margin-right: 0.75rem; accent-color: #db2777; width: 1.1rem; height: 1.1rem; }
    </style>
</head>
<body class="bg-rose-50 h-screen">

    <div class="h-full flex">
        <!-- ì‚¬ì´ë“œë°” -->
        <aside class="w-72 bg-gray-900 text-white h-full p-6 flex flex-col">
            <h2 class="text-2xl font-bold mb-8 flex items-center gap-2 text-rose-400">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg>
                ì‚°ë¶€ì¸ê³¼ ë¬¸ì§„
            </h2>
            <nav id="patientListSidebar" class="flex-1 overflow-y-auto">
                <p id="patientLoadingMessage" class="text-gray-400 text-sm p-2">ë¡œë”© ì¤‘...</p>
            </nav>
            <a href="index.html" class="w-full bg-gray-700 text-white py-3 px-4 rounded-lg font-semibold hover:bg-gray-600 transition mt-auto text-center">ì²˜ìŒìœ¼ë¡œ</a>
        </aside>
        
        <!-- ë©”ì¸ ì˜ì—­ -->
        <main class="flex-1 p-10 bg-rose-50 overflow-y-auto">

            <!-- 1. í™˜ì˜ -->
            <div id="welcomePage" class="page-section active max-w-3xl mx-auto text-center mt-20">
                <h1 class="text-5xl font-bold mb-6 text-gray-800">í™˜ì˜í•©ë‹ˆë‹¤</h1>
                <div class="bg-white p-12 rounded-lg shadow-xl border border-gray-200">
                    <p class="text-2xl text-gray-700">ì™¼ìª½ ëª©ë¡ì—ì„œ <span class="text-rose-600 font-bold">ë³¸ì¸ ì´ë¦„</span>ì„ ì„ íƒí•´ì£¼ì„¸ìš”.</p>
                </div>
            </div>

            <!-- 2. ë³¸ì¸ í™•ì¸ -->
            <div id="patientVerifyPage" class="page-section max-w-2xl mx-auto">
                <button id="verifyBackButton" class="text-rose-600 font-bold mb-4 text-lg">&larr; ë’¤ë¡œê°€ê¸°</button>
                <div class="bg-white p-10 rounded-lg shadow-xl border border-gray-200">
                    <h1 class="text-3xl font-bold mb-6 text-gray-800">ë³¸ì¸ í™•ì¸</h1>
                    <p class="mb-4 text-lg"><strong id="verifyPatientName" class="text-2xl text-rose-600"></strong> ë‹˜, ìƒë…„ì›”ì¼ 6ìë¦¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
                    <form id="verifyForm">
                        <input type="tel" id="birthdateVerifyInput" class="w-full text-center text-3xl p-4 border-2 border-gray-300 rounded-lg focus:border-rose-500 focus:ring-rose-500 mb-6" maxlength="6" required placeholder="ì˜ˆ: 990101">
                        <button type="submit" class="w-full bg-rose-600 text-white py-4 px-6 rounded-lg text-xl font-bold hover:bg-rose-700 transition">í™•ì¸</button>
                    </form>
                    <p id="verifyError" class="mt-4 text-center text-red-600 font-bold"></p>
                </div>
            </div>

            <!-- 3. ìƒì„¸ ë¬¸ì§„í‘œ -->
            <div id="questionnairePage" class="page-section max-w-5xl mx-auto">
                <div class="flex items-end gap-3 mb-6">
                    <h1 class="text-3xl font-bold text-gray-800"><span id="patientNameDisplay" class="text-rose-600"></span> ë‹˜ì˜ ë¬¸ì§„í‘œ</h1>
                    <span class="text-gray-500 pb-1">ì •í™•í•œ ì§„ë£Œë¥¼ ìœ„í•´ ìì„¸íˆ ì ì–´ì£¼ì„¸ìš”.</span>
                </div>
                
                <form id="questionnaireForm">
                    
                    <!-- STEP 1: ì§„ë£Œ í•­ëª© ì„ íƒ -->
                    <div class="question-card border-l-4 border-rose-500">
                        <h2 class="text-xl font-bold mb-4 text-gray-800">Q. ì˜¤ëŠ˜ ì§„ë£Œë¥¼ ë³´ì‹œëŠ” ê°€ì¥ ì£¼ëœ ëª©ì ì€ ë¬´ì—‡ì¸ê°€ìš”?</h2>
                        <div class="grid grid-cols-2 md:grid-cols-5 gap-3">
                            <button type="button" class="category-btn p-4 border rounded-xl hover:bg-rose-50 font-bold text-gray-600 shadow-sm transition" onclick="selectCategory('pregnancy')">ğŸ¤° ì„ì‹  í™•ì¸/ê´€ë¦¬</button>
                            <button type="button" class="category-btn p-4 border rounded-xl hover:bg-rose-50 font-bold text-gray-600 shadow-sm transition" onclick="selectCategory('preparation')">ğŸŒ± ì„ì‹  ì¤€ë¹„/ë‚œì„</button>
                            <button type="button" class="category-btn p-4 border rounded-xl hover:bg-rose-50 font-bold text-gray-600 shadow-sm transition" onclick="selectCategory('period')">ğŸ©¸ ìƒë¦¬ ê´€ë ¨</button>
                            <button type="button" class="category-btn p-4 border rounded-xl hover:bg-rose-50 font-bold text-gray-600 shadow-sm transition" onclick="selectCategory('problem')">ğŸ©º ì§ˆì—¼/í†µì¦/ê²€ì§„</button>
                            <button type="button" class="category-btn p-4 border rounded-xl hover:bg-rose-50 font-bold text-gray-600 shadow-sm transition" onclick="selectCategory('contraception')">ğŸ’Š í”¼ì„ ìƒë‹´</button>
                        </div>
                        <input type="hidden" name="category" id="selectedCategoryInput" required>
                    </div>

                    <!-- ========================================== -->
                    <!-- [A] ì„ì‹  ê´€ë ¨ ìƒì„¸ ì§ˆë¬¸ -->
                    <!-- ========================================== -->
                    <div id="section-pregnancy" class="hidden-section space-y-4">
                        <div class="bg-rose-50 p-4 rounded-lg border border-rose-100 mb-4">
                            <h3 class="text-lg font-bold text-rose-800">ğŸ¤° ì„ì‹  ê´€ë ¨ ìƒì„¸ ë¬¸ì§„</h3>
                        </div>
                        <div class="question-card">
                            <label class="question-title">1. ì„ì‹  í…ŒìŠ¤íŠ¸ê¸°ë¥¼ ì‚¬ìš©í•´ ë³´ì…¨ë‚˜ìš”?</label>
                            <div class="radio-group">
                                <label><input type="radio" name="preg_test_result" value="ì–‘ì„±(ë‘ ì¤„)"> ë„¤, ë‘ ì¤„(ì–‘ì„±) í™•ì¸í–ˆìŠµë‹ˆë‹¤.</label>
                                <label><input type="radio" name="preg_test_result" value="ìŒì„±(í•œ ì¤„)"> ë„¤, í•œ ì¤„(ìŒì„±)ì´ì—ˆìŠµë‹ˆë‹¤.</label>
                                <label><input type="radio" name="preg_test_result" value="ë¯¸ì‚¬ìš©"> ì•„ë‹ˆì˜¤, ì•„ì§ ì•ˆ í•´ë´¤ìŠµë‹ˆë‹¤.</label>
                            </div>
                        </div>
                        <div class="question-card">
                            <label class="question-title">2. (ì•Œê³  ê³„ì‹ ë‹¤ë©´) í˜„ì¬ ì„ì‹  ì£¼ìˆ˜ëŠ”?</label>
                            <input type="text" name="preg_weeks" class="w-full p-3 border rounded-md" placeholder="ì˜ˆ: 8ì£¼ 3ì¼, í˜¹ì€ ëª¨ë¦„">
                        </div>
                        <div class="question-card">
                            <label class="question-title">3. í˜„ì¬ ê²ªê³  ìˆëŠ” ì¦ìƒì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.</label>
                            <div class="checkbox-group grid grid-cols-2 gap-2">
                                <label><input type="checkbox" name="preg_symptoms" value="ì…ë§"> ì…ë§/êµ¬ì—­ì§ˆ/ì†Œí™”ë¶ˆëŸ‰</label>
                                <label><input type="checkbox" name="preg_symptoms" value="ì¶œí˜ˆ"> ì§ˆ ì¶œí˜ˆ (ë¶‰ì€ìƒ‰/ê°ˆìƒ‰)</label>
                                <label><input type="checkbox" name="preg_symptoms" value="ë³µí†µ"> ë°°ê°€ ë­‰ì¹˜ê±°ë‚˜ ì•„í””</label>
                                <label><input type="checkbox" name="preg_symptoms" value="ë‘í†µ"> ì‹¬í•œ ë‘í†µ/ì–´ì§€ëŸ¬ì›€</label>
                                <label><input type="checkbox" name="preg_symptoms" value="ë¶„ë¹„ë¬¼"> ì§ˆ ë¶„ë¹„ë¬¼ ì¦ê°€/ë¬¼ ê°™ì€ ëƒ‰</label>
                                <label><input type="checkbox" name="preg_symptoms" value="íƒœë™ê°ì†Œ"> íƒœë™ì´ í‰ì†Œë³´ë‹¤ ì¤„ì—ˆìŒ</label>
                            </div>
                        </div>
                        <div class="question-card">
                            <label class="question-title">4. (ê²½ì‚°ë¶€ì˜ ê²½ìš°) ê³¼ê±° ì„ì‹ /ì¶œì‚° ì‹œ íŠ¹ì´ì‚¬í•­ì´ ìˆì—ˆë‚˜ìš”?</label>
                            <textarea name="preg_history_detail" rows="2" class="w-full p-3 border rounded-md" placeholder="ì˜ˆ: ì„ì‹ ì„± ë‹¹ë‡¨, ê³ í˜ˆì••, ì¡°ì‚°, ì œì™•ì ˆê°œ ë“±"></textarea>
                        </div>
                        <div class="question-card">
                            <label class="question-title">5. í˜„ì¬ ë³µìš© ì¤‘ì¸ ì˜ì–‘ì œë‚˜ ì•½ë¬¼ì´ ìˆë‚˜ìš”?</label>
                            <input type="text" name="preg_meds" class="w-full p-3 border rounded-md" placeholder="ì˜ˆ: ì—½ì‚°, ì² ë¶„ì œ, ê°‘ìƒì„ ì•½ ë“±">
                        </div>
                    </div>

                    <!-- ========================================== -->
                    <!-- [B] ì„ì‹  ì¤€ë¹„/ë‚œì„ ìƒì„¸ ì§ˆë¬¸ -->
                    <!-- ========================================== -->
                    <div id="section-preparation" class="hidden-section space-y-4">
                        <div class="bg-green-50 p-4 rounded-lg border border-green-100 mb-4">
                            <h3 class="text-lg font-bold text-green-800">ğŸŒ± ì„ì‹  ì¤€ë¹„/ë‚œì„ ìƒì„¸ ë¬¸ì§„</h3>
                        </div>
                        <div class="question-card">
                            <label class="question-title">1. í”¼ì„ì„ í•˜ì§€ ì•Šê³  ì„ì‹ ì„ ì‹œë„í•œ ê¸°ê°„ì€?</label>
                            <div class="radio-group grid grid-cols-2 gap-2">
                                <label><input type="radio" name="prep_duration" value="6ê°œì›” ë¯¸ë§Œ"> 6ê°œì›” ë¯¸ë§Œ</label>
                                <label><input type="radio" name="prep_duration" value="6ê°œì›”~1ë…„"> 6ê°œì›” ~ 1ë…„</label>
                                <label><input type="radio" name="prep_duration" value="1ë…„ ì´ìƒ"> 1ë…„ ì´ìƒ</label>
                                <label><input type="radio" name="prep_duration" value="2ë…„ ì´ìƒ"> 2ë…„ ì´ìƒ (ë‚œì„ ê²€ì‚¬ í¬ë§)</label>
                            </div>
                        </div>
                        <div class="question-card">
                            <label class="question-title">2. ìƒë¦¬ ì£¼ê¸°ëŠ” ê·œì¹™ì ì¸ê°€ìš”?</label>
                            <input type="text" name="prep_cycle_detail" class="w-full p-3 border rounded-md" placeholder="ì˜ˆ: 28~30ì¼ë¡œ ê·œì¹™ì , í˜¹ì€ 30~50ì¼ë¡œ ë§¤ìš° ë¶ˆê·œì¹™">
                        </div>
                        <div class="question-card">
                            <label class="question-title">3. ë°°ë€ì¼ì„ ì–´ë–»ê²Œ í™•ì¸í•˜ê³  ê³„ì‹ ê°€ìš”?</label>
                            <div class="checkbox-group">
                                <label><input type="checkbox" name="prep_method" value="ì–´í”Œ"> ìƒë¦¬ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì˜ˆì¸¡</label>
                                <label><input type="checkbox" name="prep_method" value="ë°°ë€í…ŒìŠ¤íŠ¸ê¸°"> ë°°ë€ í…ŒìŠ¤íŠ¸ê¸° ì‚¬ìš©</label>
                                <label><input type="checkbox" name="prep_method" value="ê¸°ì´ˆì²´ì˜¨"> ê¸°ì´ˆì²´ì˜¨ ì¸¡ì •</label>
                                <label><input type="checkbox" name="prep_method" value="ë³‘ì›ì´ˆìŒíŒŒ"> ì‚°ë¶€ì¸ê³¼ ë°°ë€ ì´ˆìŒíŒŒ</label>
                                <label><input type="checkbox" name="prep_method" value="ì•ˆí•¨"> íŠ¹ë³„íˆ í™•ì¸í•˜ì§€ ì•ŠìŒ</label>
                            </div>
                        </div>
                        <div class="question-card">
                            <label class="question-title">4. ê³¼ê±°ì— ì‚°ë¶€ì¸ê³¼ ì§ˆí™˜ì„ ì§„ë‹¨ë°›ì€ ì ì´ ìˆë‚˜ìš”?</label>
                            <div class="checkbox-group grid grid-cols-2 gap-2">
                                <label><input type="checkbox" name="prep_history" value="ë‹¤ë‚­ì„±"> ë‹¤ë‚­ì„± ë‚œì†Œ ì¦í›„êµ°(PCOS)</label>
                                <label><input type="checkbox" name="prep_history" value="ìê¶ê·¼ì¢…"> ìê¶ê·¼ì¢… / ìš©ì¢…</label>
                                <label><input type="checkbox" name="prep_history" value="ìê¶ë‚´ë§‰ì¦"> ìê¶ë‚´ë§‰ì¦</label>
                                <label><input type="checkbox" name="prep_history" value="ë‚˜íŒ”ê´€"> ë‚˜íŒ”ê´€ ë§‰í˜/ìˆ˜ìˆ </label>
                                <label><input type="checkbox" name="prep_history" value="ì—†ìŒ"> ì—†ìŒ</label>
                            </div>
                        </div>
                        <div class="question-card">
                            <label class="question-title">5. ë°°ìš°ì(ë‚¨í¸)ë¶„ë„ ì •ì•¡ ê²€ì‚¬ ë“± ê²€ì§„ì„ ë°›ìœ¼ì…¨ë‚˜ìš”?</label>
                            <div class="radio-group">
                                <label><input type="radio" name="prep_partner" value="ë°›ìŒ"> ë„¤, ë°›ì•˜ìŠµë‹ˆë‹¤. (ì´ìƒ ì—†ìŒ/ìˆìŒ)</label>
                                <label><input type="radio" name="prep_partner" value="ì•ˆë°›ìŒ"> ì•„ë‹ˆì˜¤, ì•„ì§ ì•ˆ ë°›ì•˜ìŠµë‹ˆë‹¤.</label>
                            </div>
                        </div>
                    </div>

                    <!-- ========================================== -->
                    <!-- [C] ìƒë¦¬ ê´€ë ¨ ìƒì„¸ ì§ˆë¬¸ -->
                    <!-- ========================================== -->
                    <div id="section-period" class="hidden-section space-y-4">
                        <div class="bg-red-50 p-4 rounded-lg border border-red-100 mb-4">
                            <h3 class="text-lg font-bold text-red-800">ğŸ©¸ ìƒë¦¬ ê´€ë ¨ ìƒì„¸ ë¬¸ì§„</h3>
                        </div>
                        <div class="question-card">
                            <label class="question-title">1. ê°€ì¥ í° ë¶ˆí¸í•¨ì€ ë¬´ì—‡ì¸ê°€ìš”? (ì¤‘ë³µ ì„ íƒ)</label>
                            <div class="checkbox-group grid grid-cols-2 gap-2">
                                <label><input type="checkbox" name="period_symptom" value="ìƒë¦¬í†µ"> ê·¹ì‹¬í•œ ìƒë¦¬í†µ</label>
                                <label><input type="checkbox" name="period_symptom" value="ê³¼ë‹¤ì›”ê²½"> ìƒë¦¬ ì–‘ì´ ë„ˆë¬´ ë§ìŒ</label>
                                <label><input type="checkbox" name="period_symptom" value="í¬ì†Œì›”ê²½"> ìƒë¦¬ ì–‘ì´ ë„ˆë¬´ ì ìŒ</label>
                                <label><input type="checkbox" name="period_symptom" value="ë¬´ì›”ê²½"> ìƒë¦¬ë¥¼ ì•ˆ í•¨ (3ê°œì›” ì´ìƒ)</label>
                                <label><input type="checkbox" name="period_symptom" value="ë¶€ì •ì¶œí˜ˆ"> ìƒë¦¬ ê¸°ê°„ì´ ì•„ë‹Œë° í”¼ê°€ ë‚¨</label>
                                <label><input type="checkbox" name="period_symptom" value="PMS"> ì‹¬í•œ ì›”ê²½ì „ ì¦í›„êµ°(ê°ì •, ë¶“ê¸°)</label>
                            </div>
                        </div>
                        <div class="question-card">
                            <label class="question-title">2. (ìƒë¦¬í†µ ì„ íƒ ì‹œ) í†µì¦ ì ìˆ˜ë¥¼ 0~10ì ìœ¼ë¡œ í‘œí˜„í•œë‹¤ë©´?</label>
                            <span class="sub-label">0:í†µì¦ ì—†ìŒ / 5:ì§„í†µì œ í•„ìˆ˜ / 10:ì‘ê¸‰ì‹¤ ê°ˆ ì •ë„</span>
                            <input type="range" name="period_pain_score" min="0" max="10" step="1" value="0" class="w-full mb-2 accent-rose-500" oninput="document.getElementById('painScoreVal').innerText = this.value">
                            <p class="text-center font-bold text-rose-600"><span id="painScoreVal">0</span> ì </p>
                        </div>
                        <div class="question-card">
                            <label class="question-title">3. ìƒë¦¬ ì–‘ì€ ì–´ëŠ ì •ë„ì¸ê°€ìš”? (íŒ¨ë“œ ì‚¬ìš©ëŸ‰)</label>
                            <select name="period_amount" class="w-full p-3 border rounded-md">
                                <option value="ë³´í†µ">ë³´í†µ (í•˜ë£¨ 3~5ê°œ êµì²´)</option>
                                <option value="ë§ìŒ">ë§ìŒ (1~2ì‹œê°„ë§ˆë‹¤ í ë»‘ ì –ìŒ / êµ´ ë‚³ëŠ” ëŠë‚Œ)</option>
                                <option value="ì ìŒ">ì ìŒ (ë¼ì´ë„ˆë¡œ ì¶©ë¶„í•¨)</option>
                            </select>
                        </div>
                        <div class="question-card">
                            <label class="question-title">4. ìµœê·¼ ê¸‰ê²©í•œ ì²´ì¤‘ ë³€í™”ë‚˜ ìŠ¤íŠ¸ë ˆìŠ¤ê°€ ìˆì—ˆë‚˜ìš”?</label>
                            <textarea name="period_change" rows="2" class="w-full p-3 border rounded-md" placeholder="ì˜ˆ: ë‹¤ì´ì–´íŠ¸ë¡œ 5kg ê°ëŸ‰, ì‹œí—˜ ê¸°ê°„ ìŠ¤íŠ¸ë ˆìŠ¤ ë“±"></textarea>
                        </div>
                        <div class="question-card">
                            <label class="question-title">5. ì–´ë¨¸ë‹ˆë‚˜ ìë§¤ ë¶„ë“¤ ì¤‘ ìê¶ ê´€ë ¨ ì§ˆí™˜ì´ ìˆë‚˜ìš”?</label>
                            <input type="text" name="period_family" class="w-full p-3 border rounded-md" placeholder="ì˜ˆ: ì–´ë¨¸ë‹ˆ ìê¶ê·¼ì¢… ìˆ˜ìˆ ">
                        </div>
                    </div>

                    <!-- ========================================== -->
                    <!-- [D] ì§ˆì—¼/í†µì¦/ê²€ì§„ ìƒì„¸ ì§ˆë¬¸ -->
                    <!-- ========================================== -->
                    <div id="section-problem" class="hidden-section space-y-4">
                        <div class="bg-purple-50 p-4 rounded-lg border border-purple-100 mb-4">
                            <h3 class="text-lg font-bold text-purple-800">ğŸ©º ì§ˆì—¼/í†µì¦/ê²€ì§„ ìƒì„¸ ë¬¸ì§„</h3>
                        </div>
                        <div class="question-card">
                            <label class="question-title">1. ë¶„ë¹„ë¬¼(ëƒ‰)ì˜ ìƒíƒœë¥¼ ìì„¸íˆ ì•Œë ¤ì£¼ì„¸ìš”.</label>
                            <div class="checkbox-group grid grid-cols-2 gap-2">
                                <label><input type="checkbox" name="prob_discharge_color" value="í°ìƒ‰ì¹˜ì¦ˆ"> í°ìƒ‰ ìœ¼ê¹¨ì§„ ë‘ë¶€/ì¹˜ì¦ˆ ê°™ìŒ</label>
                                <label><input type="checkbox" name="prob_discharge_color" value="ë…¸ë€ìƒ‰/ì—°ë‘ìƒ‰"> ì§™ì€ ë…¸ë€ìƒ‰ ë˜ëŠ” ì—°ë‘ìƒ‰</label>
                                <label><input type="checkbox" name="prob_discharge_color" value="íšŒìƒ‰/ë¬¼"> íšŒìƒ‰ë¹› ë˜ëŠ” ë¬¼ì²˜ëŸ¼ íë¦„</label>
                                <label><input type="checkbox" name="prob_discharge_color" value="í”¼ì„ì„"> í”¼ê°€ ì„ì¸ ê°ˆìƒ‰ ëƒ‰</label>
                                <label><input type="checkbox" name="prob_discharge_color" value="ëƒ„ìƒˆ"> ìƒì„  ë¹„ë¦°ë‚´ ë“± ì•…ì·¨</label>
                            </div>
                        </div>
                        <div class="question-card">
                            <label class="question-title">2. ë¶ˆí¸í•œ ê°ê°ì´ë‚˜ í†µì¦ì´ ìˆë‚˜ìš”?</label>
                            <div class="checkbox-group grid grid-cols-2 gap-2">
                                <label><input type="checkbox" name="prob_sensation" value="ê°€ë ¤ì›€"> ì™¸ìŒë¶€ê°€ ì‹¬í•˜ê²Œ ê°€ë ¤ì›€</label>
                                <label><input type="checkbox" name="prob_sensation" value="ë”°ê°€ì›€"> ì†Œë³€ ë³¼ ë•Œ ë”°ê°€ì›€/ì‘ì—´ê°</label>
                                <label><input type="checkbox" name="prob_sensation" value="ì„±êµí†µ"> ê´€ê³„ ì‹œ í†µì¦</label>
                                <label><input type="checkbox" name="prob_sensation" value="í•˜ë³µë¶€í†µì¦"> ì•„ë«ë°°ê°€ ì½•ì½• ì‘¤ì‹œê±°ë‚˜ ë¬µì§í•¨</label>
                                <label><input type="checkbox" name="prob_sensation" value="í˜¹/ì¢…ê¸°"> ì™¸ìŒë¶€ì— í˜¹ì´ë‚˜ ì¢…ê¸°ê°€ ë§Œì ¸ì§</label>
                            </div>
                        </div>
                        <div class="question-card">
                            <label class="question-title">3. ì¦ìƒì´ ì‹œì‘ëœ ì§€ ì–¼ë§ˆë‚˜ ë˜ì—ˆë‚˜ìš”?</label>
                            <input type="text" name="prob_duration" class="w-full p-3 border rounded-md" placeholder="ì˜ˆ: 3ì¼ ì „ë¶€í„°, ì¼ì£¼ì¼ ë„˜ìŒ">
                        </div>
                        <div class="question-card">
                            <label class="question-title">4. ì§ˆì—¼ì´ë‚˜ ë°©ê´‘ì—¼ ì¬ë°œì´ ì¦ì€ í¸ì¸ê°€ìš”?</label>
                            <div class="radio-group">
                                <label><input type="radio" name="prob_recurrence" value="ìì£¼"> ë„¤, í”¼ê³¤í•˜ë©´ ìì£¼ ì¬ë°œí•©ë‹ˆë‹¤.</label>
                                <label><input type="radio" name="prob_recurrence" value="ê°€ë”"> ì¼ ë…„ì— í•œë‘ ë²ˆ ì •ë„ì…ë‹ˆë‹¤.</label>
                                <label><input type="radio" name="prob_recurrence" value="ì²˜ìŒ"> ì•„ë‹ˆì˜¤, ì²˜ìŒì…ë‹ˆë‹¤.</label>
                            </div>
                        </div>
                        <div class="question-card">
                            <label class="question-title">5. ìµœê·¼ ì„±ê´€ê³„ íŒŒíŠ¸ë„ˆì˜ ë³€í™”ê°€ ìˆì—ˆë‚˜ìš”?</label>
                            <div class="radio-group">
                                <label><input type="radio" name="prob_partner" value="ìˆìŒ"> ë„¤ (ì„±ë³‘ ê²€ì‚¬ í¬ë§)</label>
                                <label><input type="radio" name="prob_partner" value="ì—†ìŒ"> ì•„ë‹ˆì˜¤</label>
                            </div>
                        </div>
                    </div>

                    <!-- ========================================== -->
                    <!-- [E] í”¼ì„ ìƒë‹´ ìƒì„¸ ì§ˆë¬¸ -->
                    <!-- ========================================== -->
                    <div id="section-contraception" class="hidden-section space-y-4">
                        <div class="bg-blue-50 p-4 rounded-lg border border-blue-100 mb-4">
                            <h3 class="text-lg font-bold text-blue-800">ğŸ’Š í”¼ì„ ìƒë‹´ ìƒì„¸ ë¬¸ì§„</h3>
                        </div>
                        <div class="question-card">
                            <label class="question-title">1. í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ í”¼ì„ ë°©ë²•ì€ ë¬´ì—‡ì¸ê°€ìš”?</label>
                            <input type="text" name="contra_current" class="w-full p-3 border rounded-md" placeholder="ì˜ˆ: ê²½êµ¬í”¼ì„ì•½, ì½˜ë”, ë¯¸ë ˆë‚˜ ì‹œìˆ  ì¤‘, ì—†ìŒ">
                        </div>
                        <div class="question-card">
                            <label class="question-title">2. ì›í•˜ì‹œëŠ” í”¼ì„ ë°©ë²•ì´ë‚˜ ìƒë‹´ ë‚´ìš©ì€?</label>
                            <div class="checkbox-group">
                                <label><input type="checkbox" name="contra_wish" value="í”¼ì„ì•½"> ê²½êµ¬í”¼ì„ì•½ ì²˜ë°©/ìƒë‹´</label>
                                <label><input type="checkbox" name="contra_wish" value="ì‚¬í›„í”¼ì„ì•½"> ì‚¬í›„í”¼ì„ì•½(ì‘ê¸‰) ì²˜ë°© í•„ìš”</label>
                                <label><input type="checkbox" name="contra_wish" value="ìê¶ë‚´ì¥ì¹˜"> ë£¨í”„/ë¯¸ë ˆë‚˜ ë“± ì‹œìˆ  ìƒë‹´</label>
                                <label><input type="checkbox" name="contra_wish" value="ì„í”Œë¼ë…¼"> ì„í”Œë¼ë…¼(íŒ” ì´ì‹) ìƒë‹´</label>
                                <label><input type="checkbox" name="contra_wish" value="ë¶€ì‘ìš©"> ê¸°ì¡´ í”¼ì„ë²• ë¶€ì‘ìš© ìƒë‹´</label>
                            </div>
                        </div>
                        <div class="question-card">
                            <label class="question-title">3. í¡ì—°ì„ í•˜ì‹œë‚˜ìš”? (í”¼ì„ì•½ ì²˜ë°© ì‹œ ì¤‘ìš”)</label>
                            <div class="radio-group">
                                <label><input type="radio" name="contra_smoking" value="í¡ì—°"> ë„¤, í”¼ì›ë‹ˆë‹¤.</label>
                                <label><input type="radio" name="contra_smoking" value="ë¹„í¡ì—°"> ì•„ë‹ˆì˜¤.</label>
                            </div>
                        </div>
                        <div class="question-card">
                            <label class="question-title">4. í˜ˆì „ì¦, ì‹¬í˜ˆê´€ ì§ˆí™˜, ìœ ë°©ì•” ë“±ì˜ ê°€ì¡±ë ¥ì´ë‚˜ ë³‘ë ¥ì´ ìˆë‚˜ìš”?</label>
                            <textarea name="contra_risk" rows="2" class="w-full p-3 border rounded-md" placeholder="ì˜ˆ: ì–´ë¨¸ë‹ˆ ìœ ë°©ì•”, ë³¸ì¸ í¸ë‘í†µ ì‹¬í•¨ ë“±"></textarea>
                        </div>
                        <div class="question-card">
                            <label class="question-title">5. í–¥í›„ ì„ì‹  ê³„íšì€ ì–¸ì œì¯¤ ìˆìœ¼ì‹ ê°€ìš”?</label>
                            <input type="text" name="contra_plan" class="w-full p-3 border rounded-md" placeholder="ì˜ˆ: 1ë…„ ë’¤, ë‹¹ë¶„ê°„ ì—†ìŒ, ìë…€ ê³„íš ëë‚¨">
                        </div>
                    </div>

                    <!-- ========================================== -->
                    <!-- [ê³µí†µ] í•„ìˆ˜ ì§ˆë¬¸ -->
                    <!-- ========================================== -->
                    <div id="common-section" class="mt-8 pt-8 border-t-4 border-gray-100 hidden-section space-y-4">
                        <h3 class="text-xl font-bold mb-4 text-gray-700">ğŸ“ ê¸°ë³¸ í•„ìˆ˜ ì •ë³´</h3>
                        
                        <div class="question-card border-l-4 border-rose-400">
                            <label class="question-title text-rose-700">ë§ˆì§€ë§‰ ìƒë¦¬ ì‹œì‘ì¼(LMP)ì€ ì–¸ì œì¸ê°€ìš”? <span class="text-sm font-normal text-gray-500">(í•„ìˆ˜)</span></label>
                            <input type="date" name="common_lmp" class="w-full p-3 border border-gray-300 rounded-md">
                        </div>

                        <div class="question-card">
                            <label class="question-title">ê³¼ê±° ì„ì‹ /ì¶œì‚°ë ¥ (G-P-A)</label>
                            <span class="sub-label">ì˜ˆ: ìì—°ë¶„ë§Œ 1íšŒ, ìœ ì‚° 1íšŒ (ì—†ìœ¼ë©´ 'ì—†ìŒ')</span>
                            <input type="text" name="common_gpa" class="w-full p-3 border rounded-md" placeholder="ì˜ˆ: 1-0-1 (ì´1ë²ˆì„ì‹ , 0ë²ˆì¶œì‚°, 1ë²ˆìœ ì‚°)">
                        </div>

                        <div class="question-card">
                            <label class="question-title">í˜„ì¬ ì•“ê³  ìˆëŠ” ì§ˆí™˜ì´ë‚˜ ì•Œë ˆë¥´ê¸°ê°€ ìˆë‚˜ìš”?</label>
                            <textarea name="common_history" rows="2" class="w-full p-3 border rounded-md" placeholder="ì˜ˆ: ê°‘ìƒì„  ì§ˆí™˜, ì•„ìŠ¤í”¼ë¦° ì•Œë ˆë¥´ê¸°"></textarea>
                        </div>

                        <div class="question-card">
                            <label class="question-title">ì˜ì‚¬ ì„ ìƒë‹˜ê»˜ ê¼­ í•˜ê³  ì‹¶ì€ ë§ì”€ì´ ìˆë‹¤ë©´ ì ì–´ì£¼ì„¸ìš”.</label>
                            <textarea name="common_goals" rows="3" class="w-full p-3 border rounded-md"></textarea>
                        </div>
                        
                        <button type="submit" class="w-full bg-rose-600 text-white py-5 px-6 rounded-xl text-xl font-bold hover:bg-rose-700 transition mt-6 shadow-lg transform hover:scale-[1.02] duration-200">
                            ë¬¸ì§„í‘œ ì œì¶œí•˜ê¸°
                        </button>
                    </div>

                    <p id="questionnaireError" class="mt-4 text-center text-red-600 font-bold"></p>
                </form>
            </div>

            <!-- 4. ì™„ë£Œ í™”ë©´ -->
            <div id="completionPage" class="page-section max-w-2xl mx-auto mt-20">
                <div class="bg-white p-12 rounded-lg shadow-xl text-center border border-gray-200">
                    <div class="text-rose-500 mb-6 flex justify-center">
                        <svg class="w-24 h-24" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    </div>
                    <h1 class="text-4xl font-bold mb-4 text-gray-800">ì ‘ìˆ˜ ì™„ë£Œ</h1>
                    <p class="text-xl text-gray-600 mb-2">ìƒì„¸í•œ ë¬¸ì§„ ê°ì‚¬í•©ë‹ˆë‹¤.</p>
                    <p class="text-gray-500">ì§„ë£Œì‹¤ ì•ì—ì„œ ì ì‹œë§Œ ëŒ€ê¸°í•´ì£¼ì„¸ìš”.</p>
                </div>
            </div>

        </main>
    </div>

    <!-- Firebase SDK Logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot, query, where, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAcxnduVJ5MpaUOzGmG1DmbUJKuUr5Uhzo",
            authDomain: "doctor-cba8a.firebaseapp.com",
            projectId: "doctor-cba8a",
            storageBucket: "doctor-cba8a.firebasestorage.app",
            messagingSenderId: "899440797117",
            appId: "1:899440797117:web:78a9f0f9b6a91b2d5b5ed4"
        };
        const appId = 'default-symptom-tracker';

        let app, db, selectedPatient = null;

        // ì „ì—­ í•¨ìˆ˜ë¡œ ì¹´í…Œê³ ë¦¬ ì„ íƒ ë¡œì§ ë…¸ì¶œ
        window.selectCategory = function(category) {
            // ëª¨ë“  ì„¹ì…˜ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.hidden-section').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('selected'));

            // ì„ íƒëœ ì„¹ì…˜ ë³´ì´ê¸°
            document.getElementById('section-' + category).style.display = 'block';
            document.getElementById('common-section').style.display = 'block';
            
            // ë²„íŠ¼ ìŠ¤íƒ€ì¼ í™œì„±í™”
            event.target.classList.add('selected');
            
            // input ê°’ ì €ì¥
            document.getElementById('selectedCategoryInput').value = category;
            
            // ìŠ¤í¬ë¡¤ ë¶€ë“œëŸ½ê²Œ ì´ë™
            document.getElementById('section-' + category).scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        try {
            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            
            const showPage = (id) => {
                document.querySelectorAll('.page-section').forEach(p => p.classList.remove('active'));
                document.getElementById(id).classList.add('active');
                if(id === 'welcomePage') {
                   document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('selected'));
                   document.querySelectorAll('.hidden-section').forEach(el => el.style.display = 'none');
                   if(document.getElementById('questionnaireForm')) document.getElementById('questionnaireForm').reset();
                }
            };

            const waitingListRef = collection(db, "artifacts", appId, "public", "data", "waiting_list");
            const q = query(waitingListRef, where("status", "in", ["waiting", "writing"]));
            
            onSnapshot(q, (snapshot) => {
                const listEl = document.getElementById('patientListSidebar');
                listEl.innerHTML = "";
                if (snapshot.empty) listEl.innerHTML = '<p class="text-gray-400 p-2">ëŒ€ê¸° í™˜ìê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                
                snapshot.forEach(doc => {
                    const p = doc.data();
                    const link = document.createElement('div');
                    link.className = 'sidebar-patient-link';
                    link.textContent = p.name;
                    link.onclick = () => {
                        selectedPatient = { id: doc.id, ...p };
                        document.querySelectorAll('.sidebar-patient-link').forEach(l => l.classList.remove('selected'));
                        link.classList.add('selected');
                        document.getElementById('verifyPatientName').textContent = p.name;
                        document.getElementById('birthdateVerifyInput').value = "";
                        showPage('patientVerifyPage');
                    };
                    listEl.appendChild(link);
                });
            });

            document.getElementById('verifyForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const inputBirth = document.getElementById('birthdateVerifyInput').value;
                if (inputBirth === selectedPatient.birthdate) {
                    document.getElementById('patientNameDisplay').textContent = selectedPatient.name;
                    await updateDoc(doc(db, "artifacts", appId, "public", "data", "waiting_list", selectedPatient.id), { status: "writing" });
                    showPage('questionnairePage');
                } else {
                    document.getElementById('verifyError').textContent = "ìƒë…„ì›”ì¼ì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
                }
            });
            document.getElementById('verifyBackButton').onclick = () => showPage('welcomePage');

            // í¼ ì œì¶œ ë¡œì§ (í™•ì¥ëœ ë°ì´í„° ìˆ˜ì§‘)
            document.getElementById('questionnaireForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const formData = new FormData(e.target);
                const category = formData.get('category');
                
                if(!category) {
                    alert("ì§„ë£Œ í•­ëª©ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.");
                    return;
                }

                // ì²´í¬ë°•ìŠ¤ ìˆ˜ì§‘ í—¬í¼ í•¨ìˆ˜
                const collectChecks = (name) => {
                    const arr = [];
                    document.querySelectorAll(`input[name="${name}"]:checked`).forEach(cb => arr.push(cb.value));
                    return arr;
                };

                // ëª¨ë“  ê°€ëŠ¥í•œ í•„ë“œë¥¼ ìˆ˜ì§‘ (undefinedëŠ” ì €ì¥ë˜ì§€ ì•ŠìŒ)
                const data = {
                    category: category,
                    submittedAt: new Date(),
                    
                    // ê³µí†µ
                    common_lmp: formData.get('common_lmp'),
                    common_gpa: formData.get('common_gpa'),
                    common_history: formData.get('common_history'),
                    common_goals: formData.get('common_goals'),

                    // ì„ì‹ 
                    preg_test_result: formData.get('preg_test_result'),
                    preg_weeks: formData.get('preg_weeks'),
                    preg_symptoms: collectChecks('preg_symptoms'),
                    preg_history_detail: formData.get('preg_history_detail'),
                    preg_meds: formData.get('preg_meds'),

                    // ì¤€ë¹„
                    prep_duration: formData.get('prep_duration'),
                    prep_cycle_detail: formData.get('prep_cycle_detail'),
                    prep_method: collectChecks('prep_method'),
                    prep_history: collectChecks('prep_history'),
                    prep_partner: formData.get('prep_partner'),

                    // ìƒë¦¬
                    period_symptom: collectChecks('period_symptom'),
                    period_pain_score: formData.get('period_pain_score'),
                    period_amount: formData.get('period_amount'),
                    period_change: formData.get('period_change'),
                    period_family: formData.get('period_family'),

                    // ë¬¸ì œ(ì§ˆì—¼/í†µì¦)
                    prob_discharge_color: collectChecks('prob_discharge_color'),
                    prob_sensation: collectChecks('prob_sensation'),
                    prob_duration: formData.get('prob_duration'),
                    prob_recurrence: formData.get('prob_recurrence'),
                    prob_partner: formData.get('prob_partner'),

                    // í”¼ì„
                    contra_current: formData.get('contra_current'),
                    contra_wish: collectChecks('contra_wish'),
                    contra_smoking: formData.get('contra_smoking'),
                    contra_risk: formData.get('contra_risk'),
                    contra_plan: formData.get('contra_plan'),
                };

                console.log("Submitting Detailed Data:", data);

                try {
                    await updateDoc(doc(db, "artifacts", appId, "public", "data", "waiting_list", selectedPatient.id), {
                        status: "completed",
                        questionnaireData: data
                    });
                    showPage('completionPage');
                } catch (err) {
                    console.error(err);
                    document.getElementById('questionnaireError').textContent = "ì œì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.";
                }
            });

            showPage('welcomePage');

        } catch (e) {
            console.error(e);
            alert("ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì˜¤ë¥˜");
        }
    </script>
</body>
</html>